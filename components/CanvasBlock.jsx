import { Rnd } from 'react-rnd'
export default function CanvasBlock({ block, editMode, onChange, onUpdatePos }){ const { id, type, value, x=0, y=0, width=300, height=null, styles={} } = block; function toEmbed(url){ try{ const u=new URL(url); const host=u.hostname.replace('www.',''); if(host.includes('youtube.com')){ const v=u.searchParams.get('v'); if(v) return `https://www.youtube.com/embed/${v}` } if(host.includes('youtu.be')){ const id=u.pathname.slice(1); if(id) return `https://www.youtube.com/embed/${id}` } if(host.includes('vimeo.com')){ const id=u.pathname.split('/').filter(Boolean).pop(); if(id) return `https://player.vimeo.com/video/${id}` } }catch(e){} return url } function content(){ if(type==='text') return <div dangerouslySetInnerHTML={{ __html: value }} />; if(type==='image') return <img src={value} style={{ width:'100%', height:'100%', objectFit:'contain' }} />; if(type==='video'){ const embed = toEmbed(value); return <div style={{ position:'relative', width:'100%', height:'100%', paddingTop:'56.25%' }}><iframe src={embed} style={{ position:'absolute', top:0, left:0, width:'100%', height:'100%' }} frameBorder='0' allowFullScreen></iframe></div> } if(type==='button') return <a className='button-primary'>{value}</a>; return null } return (<Rnd size={{ width: width, height: height || 'auto' }} position={{ x,y }} bounds='parent' enableResizing={editMode} disableDragging={!editMode} onDragStop={(e,d)=> onUpdatePos(id,{ x:d.x, y:d.y })} onResizeStop={(e,dir,ref,pos)=> onUpdatePos(id,{ x:pos.x, y:pos.y, width: parseInt(ref.style.width), height: parseInt(ref.style.height) })}><div className='card' style={{ padding:8 }}>{content()}</div></Rnd>) }
